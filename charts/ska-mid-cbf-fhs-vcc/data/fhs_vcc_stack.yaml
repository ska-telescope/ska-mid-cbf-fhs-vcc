name: fhsvcc
function: fhsvcc
domain: sensing
command: "FhsVccStackDeviceServer"
instances:
{{ range .Values.instances }}
  - {{ .name }}
{{- end }}
depends_on:
  - device: sys/database/2
readinessProbe:
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3
livenessProbe:
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3
server:
  name: "FhsVccStackDeviceServer"
  instances:
  {{- range $index, $instance := $.Values.instances }}
  - name: "{{ $instance.name }}"
    classes:
    {{- range $index, $device := $.Values.devices }}
    {{ $deviceId := $device.deviceId | default $instance.deviceId }}
    - name: {{ $device.name }}
      devices:
      - name: {{ include "substitute-device-id" (list $device.path $deviceId) }}
        properties:
          {{- range $name, $default := $.Values.properties }}
          - name: {{ snakecase $name }}
            values:
            - "{{ include "substitute-device-id" (list ((get $device $name) | default (get $instance $name) | default $default) $deviceId) }}"
          {{- end }}
          {{- range $index, $property := $device.properties }}
          - name: {{ $property.name }}
            values:
            {{- range $index, $value := $property.values }}
            - "{{ include "substitute-device-id" (list $value $deviceId) }}"
            {{- end }}
          {{- end }}
    {{- end }}
{{- end }}

image:
  registry: "{{.Values.midcbf.image.registry}}"
  image: "{{.Values.midcbf.image.image}}"
  tag: "{{.Values.midcbf.image.tag}}"
  pullPolicy: "{{.Values.midcbf.image.pullPolicy}}"

volume:
  existingClaimName: "fhs-vcc-bitstream-pv"
  mountPath: "{{ .Values.bitstreamMountPath }}"
  readOnly: false

initContainers:
- name: wait-for-bitstream-download-job
  image: bitnami/kubectl:latest
  command: 
    - sh
    - -c
  args:
    - kubectl wait --for=condition=complete --timeout=60s job/bitstream-download-job